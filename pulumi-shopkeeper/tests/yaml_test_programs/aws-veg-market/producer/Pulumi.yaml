# Set up the markets
runtime: yaml
name: test-aws
description: Pete deploys all his pumpkins from here.
packages:
  pulumi-shopkeeper:
    source: ../../../../../pulumi-shopkeeper
    version: 0.0.0

resources:
  # Reference the market stack
  marketStack:
    type: pulumi:pulumi:StackReference
    properties:
      name: "/test-aws/aws_test_market"

  # Producer
  #prod:
  #  type: pulumi-shopkeeper:AwsProducerV1
  #  properties:
  #    name: "Pete the Pumpkin Producer"
  #    description: Pumpkin Market (Prod)
  #    # https://www.pulumi.com/docs/iac/languages-sdks/yaml/yaml-language-reference/#property-access
  #    market: ${marketStack.outputs["someMarketConfiguration"]}
  dev:
    type: pulumi-shopkeeper:AwsProducerV1
    properties:
      name: "Pete the Pumpkin Producer"
      description: Pumpkin Market (Prod)
      market:
        # literals are ok, but these are typed.
        bucket           : x ${marketStack.outputs["bucket"]}
        marketMetadataKey: x ${marketStack.outputs["marketMetadataKey"]}
        marketType       : x #${marketStack.outputs["marketType"]}
        region           : x ${marketStack.outputs["region"]}

outputs:
  #producerData: ${prod.producerData}
  someMarketConfiguration: ${marketStack.outputs["someMarketConfiguration"]}